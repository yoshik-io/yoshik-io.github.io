<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ó–∞–∫–æ–Ω—ã</title>
    <style>
        body { background: #121416; color: #e0e0e0; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .header-ui { position: sticky; top: 0; background: #121416; width: 100%; display: flex; flex-direction: column; align-items: center; padding-bottom: 15px; z-index: 100; }
        .tabs { display: flex; gap: 8px; margin-bottom: 15px; background: #1e2024; padding: 8px; border-radius: 10px; }
        .tab-btn { background: none; border: none; color: #888; padding: 12px 20px; cursor: pointer; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: #3d4147; color: #fff; }
        #btn-vazno.active { background: #b71c1c; }

        .search-wrapper { position: relative; width: 100%; max-width: 850px; }
        .search-box { width: 100%; padding: 12px 40px 12px 12px; border-radius: 8px; border: 1px solid #333; background: #1e2024; color: #fff; font-size: 1rem; box-sizing: border-box; }
        .clear-search { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #888; cursor: pointer; font-size: 1.2rem; display: none; }
        .clear-search:hover { color: #fff; }

        .container { width: 100%; max-width: 850px; }
        .card { background: #1a1c20; border: 1px solid #2d3035; border-radius: 12px; padding: 20px; margin-bottom: 15px; position: relative; }
        .tag { background: #282b30; color: #00e5ff; padding: 4px 10px; border-radius: 5px; font-weight: 800; margin-right: 10px; }
        .title { font-weight: 700; color: #fff; font-size: 1.1rem; }
        
        .text { color: #cfcfcf; margin-top: 10px; line-height: 1.5; }
        .collapsed-view { overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; }
        .expanded { display: block !important; -webkit-line-clamp: unset !important; }
        
        mark { background: #ffea00; color: #000; border-radius: 2px; padding: 0 2px; }
        .expand-btn { display: none; color: #00e5ff; cursor: pointer; font-size: 0.85rem; font-weight: bold; margin-top: 8px; }

        .card-footer { margin-top: 15px; padding-top: 10px; border-top: 1px solid #2d3035; display: flex; justify-content: space-between; }
        .penalty { color: #ffa726; font-weight: bold; }
        .stars { color: #ff5252; letter-spacing: 3px; }

        .timing-grid { display: flex; flex-direction: column; margin-top: 15px; border: 1px solid #333; border-radius: 8px; background: #1e2024; overflow: hidden; }
        .grid-row { display: flex; border-bottom: 1px solid #2d3035; align-items: center; }
        .grid-row:last-child { border-bottom: none; }
        .grid-header { background: #282b30; color: #00e5ff; font-weight: 800; font-size: 0.8rem; text-transform: uppercase; }
        .grid-cell { padding: 10px; flex: 1; }
        .cell-time { flex: 0 0 100px; color: #ffa726; font-weight: bold; border-left: 1px solid #2d3035; border-right: 1px solid #2d3035; text-align: center; }
        .cell-law { flex: 0 0 120px; font-size: 0.85rem; color: #888; text-align: right; }

        .internal-link { color: #00e5ff; text-decoration: underline; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .internal-link:hover { color: #fff; text-shadow: 0 0 8px #00e5ff; }
    </style>
</head>
<body>

    <div class="header-ui">
        <div class="tabs">
            <button id="btn-vazno" class="tab-btn" onclick="switchTab('vazno')">üî• –í–ê–ñ–ù–û</button>
            <button id="btn-uak" class="tab-btn" onclick="switchTab('uak')">–£–ê–ö</button>
            <button id="btn-pk" class="tab-btn" onclick="switchTab('pk')">–ü—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω—ã–π</button>
            <button id="btn-dk" class="tab-btn" onclick="switchTab('dk')">–î–æ—Ä–æ–∂–Ω—ã–π</button>
            <button id="btn-por" class="tab-btn" onclick="switchTab('por')">–ü–æ—Ä—è–¥–æ–∫</button>
        </div>
        <div class="search-wrapper">
            <input type="text" id="searchInput" class="search-box" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É, –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —Ç–µ–∫—Å—Ç—É" oninput="search()">
            <span id="clearBtn" class="clear-search" onclick="clearSearch()" style="display: none;">‚úñ</span>
        </div>
    </div>

    <div id="content" class="container"></div>

    <script src="vazno.js"></script><script src="uak.js"></script><script src="pk.js"></script><script src="por.js"></script><script src="dk.js"></script>

    <script>
        let currentType = 'vazno';
        let isSearching = false;
        let lastQuery = '';

        // –§—É–Ω–∫—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–∫–ª–∞–¥–∫–∏ (–ë–ï–ó –∑–∞–º–µ–Ω—ã —Ç–æ—á–µ–∫ –∏ —Å–ª—ç—à–µ–π)
        function fixLayout(str) {
            const replacer = {
                "q":"–π", "w":"—Ü", "e":"—É", "r":"–∫", "t":"–µ", "y":"–Ω", "u":"–≥", "i":"—à", "o":"—â", "p":"–∑", "[":"—Ö", "]":"—ä",
                "a":"—Ñ", "s":"—ã", "d":"–≤", "f":"–∞", "g":"–ø", "h":"—Ä", "j":"–æ", "k":"–ª", "l":"–¥", ";":"–∂", "'":"—ç",
                "z":"—è", "x":"—á", "c":"—Å", "v":"–º", "b":"–∏", "n":"—Ç", "m":"—å"
            };
            return str.replace(/[A-z,;'\]\[]/g, function (st) {
                return replacer[st.toLowerCase()] || st;
            });
        }

        function goToTab(type) {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            switchTab(type);
        }

        function switchTab(type) {
            currentType = type;
            clearSearch();
            localStorage.setItem('selectedTab', type);
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById('btn-' + type);
            if (activeBtn) activeBtn.classList.add('active');
            render(getCurrentData());
        }

        function getCurrentData() {
            try {
                if(currentType === 'vazno') return vazno_data;
                if(currentType === 'uak') return uak_data;
                if(currentType === 'pk') return pk_data;
                if(currentType === 'por') return por_data;
                if(currentType === 'dk') return dk_data;
            } catch(e) { return []; }
        }

        function clearSearch() {
            const input = document.getElementById('searchInput');
            input.value = '';
            document.getElementById('clearBtn').style.display = 'none';
            isSearching = false;
            lastQuery = '';
            render(getCurrentData());
        }

        function search() {
            const input = document.getElementById('searchInput');
            const clearBtn = document.getElementById('clearBtn');
            const rawInput = input.value.toLowerCase().trim();
            
            // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å–∫–ª–∞–¥–∫—É, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ—á–∫–∏/—Å–ª—ç—à–∏
            const query = fixLayout(rawInput);
            const normalizedQuery = query.replace(/\//g, '.'); 
            
            lastQuery = query;
            clearBtn.style.display = rawInput ? 'block' : 'none';

            if (!rawInput) {
                isSearching = false;
                render(getCurrentData());
                return;
            }

            isSearching = true;

            let results = getCurrentData().map(item => {
                const itemCodeRaw = (item.code || "").toLowerCase();
                const itemCodeNormalized = itemCodeRaw.replace(/\//g, '.');
                const itemTitle = (item.title || "").toLowerCase();
                const itemText = (item.text || "").toLowerCase();
                
                let score = 0;
                // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ù–æ–º–µ—Ä —Å—Ç–∞—Ç—å–∏ (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π 12.7 –∏ 12/7)
                if (itemCodeRaw.includes(query) || itemCodeNormalized.includes(normalizedQuery) || itemCodeNormalized.includes(query)) score += 100;
                // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ó–∞–≥–æ–ª–æ–≤–æ–∫
                if (itemTitle.includes(query)) score += 50;
                // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –¢–µ–∫—Å—Ç
                if (itemText.includes(query)) score += 10;

                return { ...item, score };
            }).filter(item => item.score > 0);

            results.sort((a, b) => b.score - a.score);
            render(results);
        }

        function highlight(text, query) {
            if (!query) return text;
            const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(${escapedQuery})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }

        function toggleText(btn) {
            const textElement = btn.previousElementSibling;
            const isExpanded = textElement.classList.toggle('expanded');
            btn.innerText = isExpanded ? '–°–≤–µ—Ä–Ω—É—Ç—å' : '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å';
        }

        function render(data) {
            const container = document.getElementById('content');
            container.innerHTML = '';
            
            data.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                
                // –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –¢–û–õ–¨–ö–û –≤ –ü—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω–æ–º –∏ –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–∏—Å–∫–∞
                const shouldCollapse = (currentType === 'pk' && !isSearching);
                const textClass = shouldCollapse ? 'text collapsed-view' : 'text';

                const displayTitle = isSearching ? highlight(item.title, lastQuery) : item.title;
                const displayText = isSearching ? highlight(item.text, lastQuery) : item.text;

                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º penalty/stars –≤ –ü—Ä–æ—Ü–µ—Å—Å—É–∞–ª—å–Ω–æ–º
                const showFooter = currentType !== 'pk' && (item.penalty || item.wanted_stars > 0);

                card.innerHTML = `
                    <div><span class="tag">${item.code || item.id}</span><span class="title">${displayTitle}</span></div>
                    <div class="${textClass}" id="text-${index}">${displayText}</div>
                    <div class="expand-btn" id="btn-${index}" onclick="toggleText(this)">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å</div>
                    ${showFooter ? `
                        <div class="card-footer">
                            <span class="penalty">${item.penalty || ''}</span>
                            <span class="stars">${'‚òÖ'.repeat(item.wanted_stars || 0)}</span>
                        </div>` : ''}
                `;
                container.appendChild(card);

                const textElem = document.getElementById(`text-${index}`);
                const btnElem = document.getElementById(`btn-${index}`);
                
                if (shouldCollapse && textElem.scrollHeight > textElem.offsetHeight) {
                    btnElem.style.display = 'inline-block';
                }
            });
        }

        window.onload = () => switchTab(localStorage.getItem('selectedTab') || 'vazno');
    </script>
</body>
</html>


